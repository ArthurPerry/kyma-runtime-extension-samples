## Overview

This sample provides a CAP Service application service which displays orders. Within the service a CDS action exists which is used to call an external application. This application generates an order which is then saved into the database. Deployment to Kyma is done using a Helm chart generated by CAP. Within Kyma, the external application is being accessed using a BTP Destination via the Cloud Connector.

## This sample demonstrates how to:

- Configure the CAP application to run locally
- Configure and build docker images using Paketo
- Generating a Helm chart with the CAP tooling which includes
  - Connecting a CAP application to Hana Cloud
  - Creating an XSUAA service instance
  - Creating a Destination service instance
  - Creating a Connectivity proxy service instanace

## Prerequisites

- SAP BTP, Kyma runtime instance
- [Docker](https://www.docker.com/)
- [Docker Hub Account](https://hub.docker.com/signup)
- [Node.js](https://nodejs.org/en/)
- [kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/) configured to use the `KUBECONFIG` file downloaded from the Kyma runtime.
- [Paketo](https://paketo.io/)
- [SAP Cloud Connector](https://tools.eu1.hana.ondemand.com/#cloud)

## Steps

### Run the frontend locally

1. Clone the project.

2. Inside the `app` directory, run:

```shell
npm install
```

3. Install the CAP tools

```shell
npm i -g @sap/cds-dk
```

4. Verify the CAP tools install by running

```shell
cds
```

5. Run the app using the command

```shell
cds watch
```

The application loads at `http://localhost:4004` and is configured with dummy authentication and can be accessed using **user**: kyma **password**: kyma

> The file **request.http** can also be used to call the service which requires **REST Client for Visual Studio Code** to be installed.

```shell
curl http://localhost:4004/orders/Orders -u kyma:kyma
```

### Run the mock appliction locally

This example relies on the mock application found in the [connectivity-proxy](../connectivity-proxy/). Following the instructions to run this application locally. The mock application is accessed by calling the following action of the CAP application.

```shell
curl -X POST http://localhost:4004/orders/external -u kyma:kyma -H "Content-Type: application/json" -d '{"orderNo":100}'
```

### Creating the Destination

This sample will rely on the Destination service to obtain the details of the localmock system. Within your BTP subaccount, choose the menu option **Connectivity -> Destinations**. Choose the option to import and import the file [destination](./destination)

### Configure the SAP Cloud Connector

Following the instructions to configure the localmock application within the SAP Cloud Connector found in the mock application sample at [connectivity-proxy](../connectivity-proxy/)

### Configure the Helm chart
